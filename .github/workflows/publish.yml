on:
  workflow_call:
    secrets:
      api_key:
        required: true

jobs:
  Publish_Package:
    name: Publish Package
    runs-on: ubuntu-latest
    environment: Release
    steps:
    - name: Download Signed Packages
      uses: actions/download-artifact@v2
      with:
        name: signed
        path: signed

    - name: Setup NuGet
      uses: NuGet/setup-nuget@v1.0.5

    - name: Push Stable Package
      run: |
        $fileName = (Get-ChildItem -Recurse -Filter *.nupkg | Select -Property Name).Name
        nuget push signed/$fileName -Source https://api.nuget.org/v3/index.json -ApiKey ${{ secrets.api_key }} -Verbosity detailed -NonInteractive
      shell: pwsh
