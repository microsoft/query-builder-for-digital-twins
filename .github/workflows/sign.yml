on:
  workflow_call:
    secrets:
      client_id:
        required: true
      az_creds:
        required: true
      az_sub:
        required: true
      storage_name:
        required: true
      container_name:
        required: true
      vault_name:
        required: true
      aad_cert:
        required: true
      sign_cert:
        required: true
      signing_cert_fingerprint:
        required: true

jobs:
  Sign:
    runs-on: windows-latest
    steps:
    - name: Download Unsigned Packages
      uses: actions/download-artifact@v2
      with:
        name: unsigned
        path: unsigned

    - name: Setup NuGet
      uses: NuGet/setup-nuget@v1.0.5

    - name: Azure Login
      uses: azure/login@v1
      with:
          creds: ${{ secrets.az_creds }}

    - name: Run Signing Script
      run: ./.github/scripts/sign.ps1 ADD THE ARGS HERE

    - name: Azure logout
      run: az logout
      if: always()

    - name: Upload Signed Packages
      uses: actions/upload-artifact@v2
      with:
        name: signed
        path: signed
